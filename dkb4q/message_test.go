package dkb4q

import (
	"testing"

	"github.com/google/go-cmp/cmp"
)

func TestEncodeReport(t *testing.T) {
	cases := []struct {
		inType       byte
		inData, want []byte
	}{
		{
			inType: 0xEA,
			inData: []byte{0x78, 0x03, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
			want:   []byte{0xEA, 0x0B, 0x78, 0x03, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9F, 0x00},
		},
		{
			inType: 0xEA,
			inData: []byte{0x78, 0x08, 0x05, 0x01, 0x60, 0x61, 0x62},
			want:   []byte{0xEA, 0x08, 0x78, 0x08, 0x05, 0x01, 0x60, 0x61, 0x62, 0xF5, 0x00, 0x00, 0x00, 0x00},
		},
		{
			inType: 0xEA,
			inData: []byte{0x78, 0x04, 0x05, 0x1E, 0xFE, 0x01, 0x02, 0x07, 0xD0, 0x00},
			want:   []byte{0xEA, 0x0B, 0x78, 0x04, 0x05, 0x1E, 0xFE, 0x01, 0x02, 0x07, 0xD0, 0x00, 0xAC, 0x00},
		},
		{
			inType: 0xEA,
			inData: []byte{0x78, 0x0A},
			want:   []byte{0xEA, 0x03, 0x78, 0x0A, 0x9B, 0x00, 0x00},
		},
	}

	for _, tc := range cases {
		got := encodeReport(tc.inType, tc.inData)
		if diff := cmp.Diff(tc.want, got); diff != "" {
			t.Errorf("encodeReport(%#x, %#v) differs (+got/-want):\n%s", tc.inType, tc.inData, diff)
		}
	}
}
